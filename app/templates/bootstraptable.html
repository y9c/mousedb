{% extends "base.html" %}

{% block content %}

<script src="//rawgit.com/hhurz/tableExport.jquery.plugin/master/tableExport.js"></script>
<script src="//rawgit.com/vitalets/x-editable/master/dist/bootstrap3-editable/js/bootstrap-editable.js"></script>
<link rel="stylesheet" href="//rawgit.com/vitalets/x-editable/master/dist/bootstrap3-editable/css/bootstrap-editable.css">

<div class="container" style="margin-top: 10px">
    <table id="table"></table>
</div>

<script>
    var table = $('#table').bootstrapTable({
        //功能
        search: true,
        showToggle: true,
        showRefresh: true,
        showColumns: true,
        pagination: true,
        detailView: true,
        detailFormatter: "detailFormatter",

        showExport: true,
        exportOptions:{
            fileName: 'custom_file_name',
        },

        onEditableSave: function (field, row, oldValue, $el) {
            $.ajax({
                type: "post",
                url: "/api/mouse-table-edit",
                data: { strJson: JSON.stringify(row) },
                success: function (data, status) {
                    if (status == "success") {
                        alert("编辑成功");
                    }
                },
                error: function () {
                    alert("编辑失败");
                },
                complete: function () {
                }
            });
        },

        //外观
        striped: true,
        rowStyle: function (row, index) {
            //这里有5个取值代表5中颜色['active', 'success', 'info', 'warning', 'danger'];
            var strclass = "";
            if (row.pk == "2") {
                strclass = 'success';
            }
            else if (row.pk == "4") {
                strclass = 'danger';
            }
            else {
                return {};
            }
            return { classes: strclass }
        },

        //数据
        url: 'api/mouse-table-api',
        columns: [{
            field: 'pk',
            title: 'PK',
            editable: true,
        }, {
            field: 'fields.mouse_id',
            title: 'ID',
            sortable: true,
            editable: true,

        }, {
            field: 'fields.dob',
            title: 'DateofBirth',
            sortable: true,
            editable: true,
        }, {
            field: 'fields.dod',
            title: 'DateofDead',
            sortable: true,
            editable: true,
        }],

    });
</script>

<script>
    function detailFormatter(index, row) {
        detail=JSON.parse(
                $.ajax({
                    url: 'api/mouse-' + row['pk'] + '-detail-api',
                    global: false,
                    async:false,
                    error: function (jqXHR, textStatus, errorThrown) {
                        alert(jqXHR+' + '+textStatus+' + '+ errorThrown)
                    }
                }).responseText
                )[0]['fields'];

        var html = [];
        $.each(detail, function (key, value) {
            html.push('<p><b>' + key + ':</b> ' + value + '</p>');
        });
        return html.join('');
    }
</script>


{% for i in mouse_genotype %}
{{ i.sex }}
{% endfor %}
{% endblock %}
